(function(){"use strict";var t,i,n=function(n,t){return function(){return n.apply(t,arguments)}};t=function(){function t(t,i,r){this.sendMessage=n(this.sendMessage,this),this.login=n(this.login,this),this.addMessage=n(this.addMessage,this),this.scope=t,this.scope.messages=[],this.el=i,this.dialog=r,this.outputScroll=this.el.find(".console > div"),this.textBox=this.el.find('input[type="text"]'),this.el.find("form").submit(this.sendMessage),this.el.find('input[type="button"]').click(this.sendMessage),this.hub=$.connection.clunchHub,this.hub.client.addMessage=this.addMessage,this.hub.client.updateUsers=this.updateUsers,this.hub.client.login=this.login,this.hub.client.log=function(n){return console.log(n)},this.hub.client.success=function(n,t){return toastr.success(n,t)},this.hub.client.info=function(n,t){return toastr.info(n,t)},this.hub.client.warning=function(n,t){return toastr.warning(n,t)},this.hub.client.error=function(n,t){return console.error(n),toastr.error(n,t)},$.connection.hub.start().fail(function(n){return console.error(n),toastr.error(n)}),t.$on("$destroy",function(){return $.connection.hub.stop()})}return t.prototype.addMessage=function(n,t,i){return this.scope.messages.push({user:n,text:t,className:i}),this.scope.messages.length>300&&this.scope.messages.shift(),this.scope.$apply(),this.outputScroll.scrollTop(this.outputScroll.prop("scrollHeight"))},t.prototype.updateUsers=function(n){return console.log(n)},t.prototype.login=function(){var n,t=this;return n=this.dialog.dialog({dialogClass:"modal login",backdropClick:!1,keyboard:!1,template:'<div class="modal-header"><h4>Who are you?<\/h4><\/div>\n<div class="modal-body">\n    <form name="loginForm">\n        <input type="text" name="loginName" ng-model="name" required="required" size="30" maxlength="30" />\n    <\/form>\n<\/div>\n<div class="modal-footer">\n    <input type="button" class="btn" ng-click="login()" ng-disabled="loginForm.$invalid" value="Sign In" />\n<\/div>',controller:["$scope","dialog",function(n,t){return t.modalEl.find("form").submit(function(){return t.close(n.name)}),n.login=function(){return t.close(n.name)},_.delay(function(){return t.modalEl.find('input[name="loginName"]').focus()},250)}]}),n.open().then(function(n){return t.hub.server.login(n),t.textBox.focus()}),this.scope.$apply()},t.prototype.sendMessage=function(n){var t;if(n.preventDefault(),t=this.textBox.val(),t.length!==0){try{this.hub.server.send(t)}catch(i){console.error(i),toastr.error(i.message)}return this.textBox.val(""),this.textBox.focus()}},t}(),i=angular.module("clunch"),i.directive("console",function(){return{restrict:"E",replace:!0,scope:{},templateUrl:"Templates/console.html",controller:["$scope","$element","$dialog",t],link:function(){}}})}).call(this)